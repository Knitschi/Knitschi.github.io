<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMakeProjectFramework: Versioning</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="CMakeProjectFramework"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../DoxygenStylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CMakeProjectFramework
   </div>
   <div id="projectbrief">A CMake and Jenkins based C++ CI pipeline.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="../../search.html" method="get">
              <img id="MSearchSelect" src="../../search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d3/dae/_c_p_f_versioning.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Versioning </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page contains information on how the versioning problem is handled in the CPF.</p>
<h1><a class="anchor" id="CPFVersionTags"></a>
Version Tags</h1>
<p>The source of a version number is the Git repository that contains the package or CI-repository. During the <em>generate step</em>, The CPF determines the current version number of each package by reading the release version tags of the repository. This version number is then used by the <em>CPF</em> while creating distribution packages or in the production code. Because of the fully automated versioning-pipeline of a CPF project, developers can rely that builds of two different commits will never have the same version number.</p>
<dl class="section note"><dt>Note</dt><dd>All repositories that are used for a CPF project should have the release version tag <code>0.0.0</code> at one of their first commits. The CPF requires at least one release version tag for its versioning mechanism to work.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d4/d37/_c_p_f_working_with_c_p_f.html#PackageOwnership">Package ownership</a></dd></dl>
<h2><a class="anchor" id="CPFReleaseVersion"></a>
Release version format</h2>
<p><b>Format:</b> &lt;major&gt;.&lt;minor&gt;.&lt;patch&gt; <b>Examples:</b> <code>1.0.1</code>, <code>0.0.99</code> </p>
<p>The version tags must follow the given pattern in order to be recognized by the <em>CPF</em>. Tags of this form are called <em>release versions</em>. The <em>CPF</em> assumes that the commits with the release versions are the ones that are provided to clients. Release version tags must be manually added to the repository when the developer deems a commit worthy to be published. This can also be done via the build-job that is provided by the <a class="el" href="../../db/d51/namespace_c_p_f_machines.html">CPFMachines</a> package.</p>
<h2><a class="anchor" id="CPFInternalVersion"></a>
Internal version format</h2>
<p><b>Format:</b> &lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;.&lt;commit-nr.&gt;-&lt;hash&gt; <b>Examples:</b> <code>1.0.1.13-af4d</code>, <code>0.0.99.1-3h9k0s</code> </p>
<p>In order to have different version numbers for each build, the <em>CPF</em> will determine <em>internal version numbers</em> for each package whenever the <em>generate step</em> is executed. The first three <em>digits</em> are derived from the latest release version number that can be <em>seen</em> from the current commit in one of its preceding commits. The <code>&lt;commit-nr</code>.&gt; is the number of commit that have been made since the commit that has the release version. This allows to see if an internal version is older or younger than another internal version. However the commit number alone does not make the version unique, as the development could have branched since the last release version. This could lead to two commits with the same version number. For this reason the version number also contains the first digits of the commit hash. This part will be as long as is needed to make it unique.</p>
<h2><a class="anchor" id="CPFDirtyVersions"></a>
Dirty versions</h2>
<p>If the repository has local changes that have not yet been committed, the optional <code>-dirty</code> postfix is added to the version number. Dirty versions can in general not be rebuild by other developers and should therefore not be considered when trying to reproduce bugs.</p>
<h1><a class="anchor" id="CPFUseInProductionCode"></a>
Using the version number in the production code</h1>
<p>For C++ packages, the <em>CPF</em> will automatically generate a header file that contains the current version number. The version can be obtained in the C++ code by using:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MyPackage/cpfPackageVersion_MyPackage.h&gt;</span></div><div class="line"></div><div class="line">std::string version = mp::getPackageVersion();</div></div><!-- fragment --><p>assuming that you have a package <code>MyPackage</code> with namespace <code>mp</code>.</p>
<p>The package version can be accessed in the <code>CMakeLists.txt</code> file of the package via the <code>PROJECT_VERSION</code> variable after the call of the <code>cpfInitPackageProject()</code> function if you want to generate your own version files.</p>
<h1><a class="anchor" id="CPFTagsAsValidationStamp"></a>
Version tags as validation stamps</h1>
<p>In the CPF the version tags in the repository are also used to mark commits for which the pipeline target was successfully build. This is only enforced in combination with the build-job that is provided by the <a class="el" href="../../db/d51/namespace_c_p_f_machines.html">CPFMachines</a> package. The build-job adds version tags after successfully building a commit. When this policy is followed, developers can quickly see which commits are worth checking out when they try to build older versions.</p>
<h1><a class="anchor" id="CPFIncrementingVersions"></a>
Incrementing versions</h1>
<p>Version numbers are incremented by adding new release version tags to the repository. This can either be done manually or by setting certain parameters to the build-job that is provided by the <em><a class="el" href="../../db/d51/namespace_c_p_f_machines.html">CPFMachines</a></em> package. The CPF assumes that release version tags are unique and <em>ordered</em>, where smaller versions can only be followed by larger versions. Before you manually add a release version tag, you should also make sure that the pipeline target of that commit builds for all your supported configurations.</p>
<p>The build-job of the <em><a class="el" href="../../db/d51/namespace_c_p_f_machines.html">CPFMachines</a></em> package will make sure that all of these requirements are met, when incrementing version numbers.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d7/dd1/_c_p_f_jenkins_job.html#CPFJobSubsection2">Tagging a commit with a release version</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu May 10 2018 19:55:37 for CMakeProjectFramework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
