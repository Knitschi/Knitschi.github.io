<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMakeProjectFramework: Machines and Container</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="CMakeProjectFramework"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../DoxygenStylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CMakeProjectFramework
   </div>
   <div id="projectbrief">A CMake and Jenkins based C++ CI pipeline.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="../../search.html" method="get">
              <img id="MSearchSelect" src="../../search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/d67/_c_p_f_machines_container.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Machines and Container </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section contains information about the machines and containers that are used to host the services that are needed to run the CPF build-pipeline.</p>
<h2>Machine Setup</h2>
<p>This section describes which machines, virtual machines and docker images are used to provide the development infrastructure for the CppCodeBase project.</p>
<p>Currently the setup includes the native Debian machine <code>Feldrechengeraet</code>. This native machine runs three docker containers and a virtual Windows 10 machine.</p>
<p>The pipeline requires a windows based build-slave for Jenkins which is currently implemented as a virtual machine. This machine has been configured manually and then a backup was made. The backup is stored on the DatenBunker machine in the <code>/share/Knitschi/SystemBackups/CurrentBuildKnechts</code> directory. When the machine is started, a script will automatically start the jenkins-slave service.</p>
<p>The medium-term goal is to remove the need for stored virtual machines and replace them with docker containers or "blank" virtual machines plus scripts that will do the machine setup. This is supposed to improve the "documentation" of the state of the build-machines because all the scripts that define them are contained in the repository.</p>
<p>Setting up the involved docker containers on Linux only requires the execution of the <code>setupDockerContainer.sh</code> script that can be found in the <code>Infrastructure/DockerImages</code> directory of the CppCodeBase.</p>
<h3>Starting The Linux Docker Containers</h3>
<p>Currently the following machines are implemented as Linux based docker containers.</p>
<ul>
<li><b>Documentation-Server</b>: Hosts the html pages that are generated by the build pipeline. Currently this is the Doxygen documentation and a report from the OpenCppCoverage tool.</li>
<li><b>Jenkins-Master</b>: The machine that runs the Jenkins master and which is accessed to observer the build-pipeline.</li>
<li><b>Jenkins-Slave-Linux-0</b>: The machine on which the actual builds of the Linux parts of the pipeline are done.</li>
</ul>
<p>To set these machines up, one needs a debian machine that has docker and git installed. Then the CppCodeBase repository needs to be checked out in order to get the scripts. One also needs to create a directory that will act as the home directory of the jenkins-master and is shared between the host and the container. Currently this directory is hardcoded to <code>/home/knitschi/jenkinsmastercontainer</code> which may need to be transformed to an script argument later.</p>
<p>The <code>Infrastructure/DockerImages</code> folder ccbContains the <code>setupDockerContainer.sh</code> script which does all the work. Running it will require an working ssh connection to <code>Datenbunker</code> machine in order to setup the connection from the <code>jenkins-master</code> to the <code>Datenbunker</code>.</p>
<dl class="bug"><dt><b><a class="el" href="../../de/da5/bug.html#_bug000001">Bug:</a></b></dt><dd>Network issues after running setupDockerContainer.sh Setting up the docker container changes the network settings of the host. This may cause the the <code>setupDockerContainer.sh</code> script to fail when run multiple times in a row because connection to the internet can not be made. Restarting the machine on which the script is run will solve the problem.</dd></dl>
<h3>The Windows Slave</h3>
<p>There is a virtual machine that is used as a build-slave for the parts of the pipeline that must be build on Windows. Whenever the container for the <code>jenkins-master</code> machine is re-built, the connection information on the windows slave must be updated in the script that can be found on the windows-slave under</p>
<p><code>C:/jenkins/startSlave</code>.bat</p>
<p>To update the information one must to login to jenkins from within the windows-slave and go to the page</p>
<p><a href="http://feldrechengeraet:8080/computer/jenkins-slave-windows-0/">http://feldrechengeraet:8080/computer/jenkins-slave-windows-0</a></p>
<p>and copy the displayed secret into the batch file. The batch file is run after each start of the windows-slave to reestablish the connection to the jenkins-master server.</p>
<h2>The Jenkins Build Server</h2>
<p>The server is setup in the <code>jenkins-master</code> container. Manual changes to the server via the web-interface are lost when the <code>setupDockerContainer.sh</code> is re-run. This includes updates to plugins and jenkins itself. Therefore non-experimental changes must be implemented by changing the files in the <code>Infrastructure/DockerImages</code> directory. The web-page of the jenkins-server is <a href="https://jenkins.io/"><b>here</b></a>. There is a post-commit hook that starts the pipeline. The pipeline script builds the <code>pipeline</code> target on Linux and Windows in two configurations each. The pipeline script collects html output of the pipeline and copies it to a web-server.</p>
<h2>Git</h2>
<p>The Git repository is hosted on the DatenBunker machine in the directory <code>/share/GitRepositories/CppCodeBase</code>. The repository has a post-commit-hook that triggers the <a href="http://feldrechengeraet:8080/job/CppCodeBase_Build_PipeLine/">CppCodeBase_Build_Pipeline</a> job on the Jenkins server.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000008">Todo:</a></b></dt><dd>Buy a more powerfull build-machine to reduce the overall pipeline time. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Apr 20 2018 12:12:31 for CMakeProjectFramework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
