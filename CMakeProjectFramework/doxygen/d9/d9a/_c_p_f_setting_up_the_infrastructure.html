<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link rel="shortcut icon" href="./CPFLogoSmall.svg">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <!--<meta name="generator" content="Doxygen 1.8.14"/> -->
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>CPFDocumentation: Setting up the CPF CI server infrastructure</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="CPFDocumentation"/>
    <!---->
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../DoxygenStylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../CPFLogoSmall.svg" style="width:65px;height:65px;" /></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CPFDocumentation
   </div>
   <div id="projectbrief">A C++ project infrastructure.</div>
  </td>
   <!--<td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="../../search.html" method="get">
              <img id="MSearchSelect" src="../../search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d9/d9a/_c_p_f_setting_up_the_infrastructure.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Setting up the CPF CI server infrastructure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page contains a tutorial on how to use the scripts provided by the <em>CPFMachines</em> package to set up a continuous integration server infrastructure for you CPF projects. The tutorial assumes that you are familiar with the <a class="el" href="../../d4/d37/_c_p_f_working_with_c_p_f.html">Working with a CPF project</a> and the <a class="el" href="../../d9/dc9/_c_p_f_setting_up_a_c_p_f_project.html">Setting up a CPF project</a> tutorials. The tutorial also assumes that you have a CPF project provided by a remote git repository that can be pulled and pushed to via the SSH protocol. It assumes you can clone that repository with</p>
<div class="fragment"><div class="line">&gt;git clone --recursive ssh://myuser@mydebianpc:/home/myuser/repositories/MyCPFProject.git</div></div><!-- fragment --><h1><a class="anchor" id="CPFMachinesTutorial"></a>
Step by step tutorial for setting up the CPF CI infrastructure</h1>
<p>The main functionality of the <em>CPFMachines</em> package is provided by a python script <code>setup.py</code>. The script accesses the machines that belong to your environment over SSH in order to setup a Jenkins CI server, build slaves and web-servers for your CPF project pages. The script reads a configuration <code></code>.json file that contains values like machine access data, the number of slaves that you desire, etc. This tutorial gives you an example on how to use create a correct configuration file, provide the host machines for your servers and finally how to run the <code>setup.py</code> script.</p>
<h2><a class="anchor" id="CPFCreateConfigRepository"></a>
1. Create a repository for your configuration files</h2>
<p>In order to use the <em>CPFMachines</em> package you will have to create some custom configuration files, that will define some basic properties of your server setup. It is not necessary but recommended that you add these files to a git repository. You can also use this repository to add other files with helper scripts and such that you use for handling your infrastructure.</p>
<div class="fragment"><div class="line">&gt;mkdir MyCPFMachines.git</div><div class="line">&gt;cd MyCPFMachines.git</div><div class="line">&gt;git init --bare --share</div><div class="line">&gt;cd ..</div><div class="line">&gt;git clone MyCPFMachines.git</div></div><!-- fragment --><p>We now add the <em>CPFMachines</em> package as a git submodule.</p>
<div class="fragment"><div class="line">&gt;cd MyCPFMachines</div><div class="line">&gt;git submodule add https://github.com/Knitschi/CPFMachines.git</div></div><!-- fragment --><h2><a class="anchor" id="CPFProvideMachinesWithSSHAccess"></a>
3. Provide host machines with SSH access</h2>
<p>If you want your CPF project to be build on Linux and Window, you have to at least provide one Debian 8.9 and one Windows 10 machine. This tutorial assumes this minimalist setup. The machines can be virtual or physical ones. After you learned the basics you can still add more machines for in order to provide more build slaves. If you do not care for Windows builds, you can leave away the Windows machine. If you only want to do Windows builds, you will still need the Linux machine as it will host the jenkins and web server.</p>
<ol type="1">
<li>Get two fresh physical or virtual machines and install Windows 10 on one, and Debian 8.9 on the other. Both machines must be attached to the local network.</li>
<li>Create an account on the Debian machine that can be accessed via SSH.</li>
<li>Install docker on the debian machine.</li>
</ol>
<ol type="1">
<li>Create an account on the Windows machine that can be accessed via SSH with the Bitvise SSH server.</li>
<li>Install build tools on the Windows machine.</li>
</ol>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000005">Todo:</a></b></dt><dd>Add more detailed instructions for the above steps?</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Currently more manual steps are required</dd></dl>
<p>The further steps assume that you can now run</p>
<div class="fragment"><div class="line">&gt;ssh myuser@mydebianpc &quot;echo blub&quot;</div><div class="line">&gt;ssh myuser@mywindowspc &quot;echo blub&quot;</div></div><!-- fragment --><p>on the machine that you want to use to run the <code>setup.py</code> script. Replace the user and machine names with the ones that you actually use.</p>
<h2><a class="anchor" id="CPFCreateConfigFile"></a>
4. Create a configuration file for your infrastructure</h2>
<p>We now add a configuration file to our MyCPFMachines repository. The file contains information about our host machines and which build-jobs we want to have on the CI server. Add a new file <code>MyCPFMachines/MyConfig.json</code> with the following content:</p>
<h4>MyConfig.json</h4>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;CPFMachinesVersion&quot;: &quot;0.0.0&quot;,</div><div class="line">  &quot;HostMachines&quot;: [</div><div class="line">    {</div><div class="line">      &quot;MachineID&quot;: &quot;MyMaster&quot;,</div><div class="line">      &quot;HostNameOrIP&quot;: &quot;mydebianpc&quot;,</div><div class="line">      &quot;User&quot;: &quot;myuser&quot;,</div><div class="line">      &quot;OSType&quot;: &quot;Linux&quot;,</div><div class="line">      &quot;TemporaryDirectory&quot;: &quot;/home/myuser/temp&quot;</div><div class="line">    },</div><div class="line">    {</div><div class="line">      &quot;MachineID&quot;: &quot;MyWindowsSlave&quot;,</div><div class="line">      &quot;HostNameOrIP&quot;: &quot;mywindowspc&quot;,</div><div class="line">      &quot;User&quot;: &quot;myuser&quot;,</div><div class="line">      &quot;OSType&quot;: &quot;Windows&quot;,</div><div class="line">      &quot;TemporaryDirectory&quot;: &quot;C:/temp&quot;</div><div class="line">    }</div><div class="line">  ],</div><div class="line">  &quot;JenkinsConfig&quot;: {</div><div class="line">    &quot;UseUnconfiguredJenkins&quot;: true,</div><div class="line">    &quot;JenkinsAdminUser&quot;: &quot;myuser&quot;,</div><div class="line">    &quot;JenkinsAdminUserPassword&quot;: &quot;1234password&quot;,</div><div class="line">    &quot;CPFJobs&quot;: [</div><div class="line">      {</div><div class="line">        &quot;JenkinsJobBasename&quot;: &quot;MyCPFProject&quot;,</div><div class="line">        &quot;Repository&quot;: &quot;ssh://myuser@mydebianpc:/home/myuser/repositories/MyCPFProject.git&quot;,</div><div class="line">        &quot;WebServerConfig&quot;: {</div><div class="line">          &quot;MachineID&quot;: &quot;MyMaster&quot;,</div><div class="line">          &quot;HostHTMLShare&quot;: &quot;/home/myuser/mycpfproject_html_share&quot;</div><div class="line">        }</div><div class="line">      }</div><div class="line">    ]</div><div class="line">  },</div><div class="line">  &quot;JenkinsMasterHost&quot;: {</div><div class="line">    &quot;MachineID&quot;: &quot;MyMaster&quot;,</div><div class="line">    &quot;HostJenkinsMasterShare&quot;: &quot;/home/myuser/jenkins_home&quot;</div><div class="line">  },</div><div class="line">  &quot;JenkinsSlaves&quot;: [</div><div class="line">    {</div><div class="line">      &quot;MachineID&quot;: &quot;MyMaster&quot;,</div><div class="line">      &quot;Executors&quot;: &quot;1&quot;</div><div class="line">    },</div><div class="line">    {</div><div class="line">      &quot;MachineID&quot;: &quot;MyWindowsSlave&quot;,</div><div class="line">      &quot;Executors&quot;: &quot;1&quot;</div><div class="line">    }</div><div class="line">  ],</div><div class="line">  &quot;RepositoryHost&quot;: {</div><div class="line">    &quot;MachineID&quot;: &quot;MyMaster&quot;,</div><div class="line">    &quot;SSHDir&quot;: &quot;/home/myuser/.ssh&quot;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>With this configuration you will get the jenkins master server, a jenkins linux agent and the web-server on the <em>mydebianpc</em> machine. The <em>mywindowspc</em> will be used to run a jenkins windows agent. Jenkins will be configured to have one build job <em>MyCPFProject</em> that will build your CPF project. You can get more information about the configuration file <a class="el" href="../../dd/d47/_c_p_f_machines_config_file.html">here</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Adding passwords for your accounts to the config file is optional. It may be saver to leave them out, but it comes with the inconvenience that you have to re-enter them whenever you want to run the <code>setup.py</code> script.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000006">Todo:</a></b></dt><dd>Improve the setup script to allow the creation of an admin account on the first run.</dd></dl>
<h2><a class="anchor" id="CPFRunSetupScript"></a>
5. Run the setup.py script</h2>
<p>We now have done all the manual preparations that are necessary to install the servers.</p>
<div class="fragment"><div class="line">&gt;python -m CPFMachines.setup MySetup.json</div></div><!-- fragment --><p>Running the script may take quite some time, as some of the required tools are freshly compiled when running the script. If the script fails to run successfully, see if you can find the problem on the trouble shooting page <a class="el" href="../../d9/daf/_c_p_f_machines_problems.html">here</a>.</p>
<h2><a class="anchor" id="CPFAddCommitHooks"></a>
6. Add commit hooks to your repositories</h2>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<div id="nav-path" class="navpath-cpf"><!-- id is needed for treeview function! -->
  <ul>
    <!-- -->
    <li class="footer">Created with Doxygen 1.8.14</li>
  </ul>
</div>
</body>
</html>
